# 목표

자바의 람다식에 대해 학습하세요.

## 학습할 것 (필수)

- 람다식 사용법
- 함수형 인터페이스
- Variable Capture
- 메소드, 생성자 레퍼런스

### 람다식 사용법

람다식은 메서드를 하나의 식으로 표현한 것이다.

메서드에서 이름과 반환타입을 제거하고 매개변수 선언부와 몸통 대괄호 사이에 '->'를 추가한다.

```java
(parameter) -> {
  // do something ...
}
```

람다를 선언할때는 몇가지 규칙이 있다.

- 매개변수가 한개일때는 괄호를 생략할 수 있다.
- 매개변수의 타입이 추론이 가능한 경우 생략할 수 있다.
- 반환값이 있는 메서드의 경우, return문을 생략하고 식으로 대체할 수 있다.
- 괄호 안의 문장이 하나일 경우 괄호{}를 생략할 수 있다.

### 함수형 인터페이스

함수형 인터페이스는 람다식을 다루기 위한 인터페이스 이며, @FunctionalInterface 어노테이션을 사용해 적용할 수 있다. 함수형 인터페이스는 오직 하나의 추상 메서드만 정의되어 있어야 하는 제약이 있다.

#### 함수형 인터페이스 타입의 매개변수와 반환타입

- 메서드의 매개변수가 함수형 인터페이스 타입인 경우, 이 메서드를 호출할 때 람다식을 참조하는 참조변수를 매개변수로 지정해야 한다.
- 또는 참조변수 없이 직접 람다식을 배개변수로 지정할 수 있다.

#### 람다식의 타입과 형변환

함수형 인터페이스로 람다식을 참조할 수 있을 뿐, 람다식이 함수형 인터페이스의 타입과 일치하는 것은 아니다.

- 대입 연산자의 양변에 타입을 일치하기 위해 형변환이 필요하다.
- Object타입으로 형변환 할 수 없고, 함수형 인터페이스로만 형변환이 가능하다.

#### 외부 변수를 참조하는 람다식

람다식에서 외부 변수를 참조하는 것은 익명 클래스와 동일하다.

- 람다식 내에서 참조하는 지역변수는 final이 붙지 않아도 상수로 간주된다. 람다식 내와 다른 곳에서도 이 값을 변경할 수 없다.

### Variable Capture

람다 내부에서는 람다 외 다른 변수를 참조할 수 있는데, 제약 조건이 있다.

- 지역변수는 final로 선언되어 있어야 한다.
- final로 선언되지 않은 변수는 final처럼 동작해야 한다.

해당 제약 조건이 생긴 이유

- 지역 변수는 jvm중 stack 영역에 저장되고, 이 stack은 각 스레드가 가지고 있다.
- 람다는 별도의 스레드에서 실행이 가능하다.
- 원래 해당 지역변수에 대해 참조하고 있는 스레드가 사라져 지역 변수가 사라져도, 람다가 실행 중인 스레드는 살아 있을 수 있다.
- 람다는 별도의 스레드에서 실행되므로, 해당 지역변수의 값을 스택에 복사해서 사용한다. 그렇기에 지역변수가 사라지더라도 본인의 역할을 수행한다.
- 하지만 이처럼 변수의 값을 복사해서 쓰지만 그 변수의 값이 계속해서 변경된다고 하면 side effect를 초래할 수 있다.

### 메소드, 생성자 레퍼런스

람다식이 하나의 메서드만 호출하는 경우 메서드 참조 기법으로 람다식을 더 간략히 할 수 있다.

```java
Function<Integer, String> g = (i) -> Integer.toBinaryString(i);
Function<Integer, String> g = Integer::toBinaryString;
```

생성자를 호출하는 람다식도 메서드 참조로 변환할 수 있다.

매개변수가 있는 생성자라면, 매개변수의 개수에 따라 알맞은 함수형 인터페이스를 사용하면 된다. 필요하다면 함수형 인터페이스를 새로 정의해야 한다.

```java
Supplier<LambdaEx> supplier = () -> new LambdaEx();
Supplier<LambdaEx> supplier = LambdaEx::new;

Function<Integer, LambdaEx> function = (i) -> new LambdaEx(i);
Function<Integer, LambdaEx> function = LambdaEx::new;
```

### 링크

- https://perfectacle.github.io/2019/06/30/java-8-lambda-capturing/
